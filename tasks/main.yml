---

- name: Load variables based on OS type
  include_vars: "{{ lookup('first_found', params) }}"
  vars:
    params:
      files:
        - "{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
        - "{{ ansible_distribution }}.yml"
        - "family-{{ ansible_os_family }}-{{ ansible_distribution_major_version }}.yml"
        - "family-{{ ansible_os_family }}.yml"
        - default.yml
      paths:
        - "vars"

- name: Install RPM w/ all remi repositories
  yum:
    name: https://rpms.remirepo.net/enterprise/remi-release-{{ ansible_distribution_major_version }}.rpm
    state: present
    disable_gpg_check: yes
  when: ansible_os_family == 'RedHat'

- name: Install all php packages
  package:
    name: "{{ php_packages }}"
    state: present

- name: Search for all php.ini
  find:
    paths: /etc
    pattern: php.ini
    recurse: true
  register: _php_ini

- name: Set the correct timezone
  replace:
    path: "{{ item.path }}"
    regexp: '^(;)?date.timezone =.*'
    replace: 'date.timezone = Europe/Amsterdam'
  loop: "{{ _php_ini.files }}"
  loop_control:
    label: "{{ item.path }}"
